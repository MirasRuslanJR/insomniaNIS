<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoChain - Map and Actions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="../styles/custom.css">
    <link rel="stylesheet" href="../styles/map.css">
</head>
<body class="bg-gray-50">
    <!-- nav -->
    <nav class="bg-white shadow-sm sticky top-0" style="z-index: 100;">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <a href="./index.html" class="flex items-center space-x-2">
                    <div class="w-9 h-9 bg-gradient-to-br from-green-600 to-green-800 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg">üå±</span>
                    </div>
                    <span class="text-xl font-bold text-gray-800">EcoChain</span>
                </a>
                <div class="desktop-nav flex items-center space-x-5 text-sm">
                    <a href="./map.html" class="text-green-700 font-semibold">–ö–∞—Ä—Ç–∞</a>
                    <a href="./challenges.html" class="text-gray-600 hover:text-green-700">–ß–µ–ª–ª–µ–Ω–¥–∂–∏</a>
                    <a href="./verify.html" class="text-gray-600 hover:text-green-700">–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è</a>
                    <a href="./dashboard.html" class="text-gray-600 hover:text-green-700">–ü—Ä–æ—Ñ–∏–ª—å</a>
                </div>
                <div class="md:hidden flex gap-2 text-xs">
                    <a href="./challenges.html" class="px-2 py-1 bg-gray-100 rounded-lg">üèÜ</a>
                    <a href="./verify.html" class="px-2 py-1 bg-gray-100 rounded-lg">‚úÖ</a>
                    <a href="./dashboard.html" class="px-2 py-1 bg-gray-100 rounded-lg">üë§</a>
                </div>
            </div>
        </div>
    </nav>
    <!-- main layout -->
    <div class="map-layout flex" style="height: calc(100vh - 57px);">
        <!-- sidebar -->
        <div class="sidebar w-80 p-5">
            <h2 class="text-xl font-bold mb-4 text-gray-800">üó∫Ô∏è –î–µ–π—Å—Ç–≤–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ</h2>
            <div class="filter-panel mb-4">
                <div class="mb-3">
                    <label class="block text-xs font-bold mb-1 text-gray-600">–°–¢–ê–¢–£–°</label>
                    <select id="statusFilter" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white">
                        <option value="all">–í—Å–µ</option>
                        <option value="pending">‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏</option>
                        <option value="verified">‚úÖ –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ</option>
                        <option value="rejected">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="block text-xs font-bold mb-1 text-gray-600">–¢–ò–ü</label>
                    <select id="typeFilter" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white">
                        <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="cleanup">üßπ –£–±–æ—Ä–∫–∞</option>
                        <option value="tree">üå≥ –î–µ—Ä–µ–≤—å—è</option>
                        <option value="recycle">‚ôªÔ∏è –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞</option>
                        <option value="bike">üö≤ –í–µ–ª–æ—Å–∏–ø–µ–¥</option>
                        <option value="water">üíß –í–æ–¥–∞</option>
                        <option value="energy">üí° –≠–Ω–µ—Ä–≥–∏—è</option>
                        <option value="education">üìö –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏–µ</option>
                        <option value="other">üå± –î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <button id="applyFilters" class="w-full bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition text-sm">
                    –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                </button>
            </div>
            <button onclick="showAddModal()" class="w-full mb-4 px-4 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition md:hidden">
                + –î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
            </button>
            <div id="actionsList">
                <div class="text-center py-8 text-gray-400">
                    <div class="animate-spin rounded-full h-8 w-8 border-2 border-green-500 border-t-transparent mx-auto mb-2"></div>
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
            </div>
        </div>
        <!-- map -->
        <div class="map-container flex-1 relative">
            <div id="map"></div>
            <button id="addActionBtn" onclick="showAddModal()"
                    class="hidden md:block px-5 py-2.5 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition shadow-lg">
                + –î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
            </button>
        </div>
    </div>

    <!--add action modal-->
    <div id="addActionModal" class="modal-overlay">
        <div class="modal-box">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">üå± –ù–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</h3>
                <button onclick="hideAddModal()" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition">
                    ‚úï
                </button>
            </div>

            <form id="addActionForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-bold mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                    <input type="text" id="actionTitle" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ" required>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                    <textarea id="actionDescription" rows="2" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏..." required></textarea>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-bold mb-1">–¢–∏–ø *</label>
                        <select id="actionType" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500">
                            <option value="cleanup">üßπ –£–±–æ—Ä–∫–∞</option>
                            <option value="tree">üå≥ –î–µ—Ä–µ–≤–æ</option>
                            <option value="recycle">‚ôªÔ∏è –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞</option>
                            <option value="bike">üö≤ –í–µ–ª–æ—Å–∏–ø–µ–¥</option>
                            <option value="water">üíß –í–æ–¥–∞</option>
                            <option value="energy">üí° –≠–Ω–µ—Ä–≥–∏—è</option>
                            <option value="education">üìö –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏–µ</option>
                            <option value="other">üå± –î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                        <input type="number" id="actionQuantity" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500" value="1" min="1">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">–§–æ—Ç–æ –î–û (–ø—Ä–æ–±–ª–µ–º–∞) *</label>
                    <input type="file" id="photoBefore" accept="image/*" capture="environment" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" required>
                    <div id="photoBeforePreview"></div>
                </div>
                <div>
                    <button type="button" id="getLocationBtn" class="w-full px-4 py-2.5 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg font-semibold hover:bg-blue-100 transition">
                        üìç –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é
                    </button>
                    <div id="locationInfo" class="mt-1 text-sm"></div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="hideAddModal()" class="flex-1 py-2.5 border-2 border-gray-300 rounded-lg font-semibold hover:bg-gray-50 transition">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="flex-1 py-2.5 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">
                        –°–æ–∑–¥–∞—Ç—å üå±
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!--complete action modal-->
    <div id="completeActionModal" class="modal-overlay">
        <div class="modal-box">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ</h3>
                <button onclick="hideCompleteModal()" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600 transition">
                    ‚úï
                </button>
            </div>

            <form id="completeActionForm" class="space-y-4">
                <div class="p-4 bg-green-50 border border-green-200 rounded-xl text-sm text-green-800">
                    üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Äî —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥—Ä—É–≥–∏–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">–§–æ—Ç–æ –ü–û–°–õ–ï (—Ä–µ–∑—É–ª—å—Ç–∞—Ç) *</label>
                    <input type="file" id="photoAfter" accept="image/*" capture="environment" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" required>
                    <div id="photoAfterPreview"></div>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea id="completionComment" rows="2" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:border-green-500" placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ..."></textarea>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="hideCompleteModal()" class="flex-1 py-2.5 border-2 border-gray-300 rounded-lg font-semibold hover:bg-gray-50 transition">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="flex-1 py-2.5 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">
                        –ó–∞–≤–µ—Ä—à–∏—Ç—å ‚úÖ
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="../js/globalmodalsettings.js"></script>
    <script type="module" src="../js/firebase-config.js"></script>
    <script type="module" src="../js/auth.js"></script>
    <script type="module" src="../js/map.js"></script>
</body>
</html>